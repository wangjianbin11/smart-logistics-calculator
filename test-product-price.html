<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“ä»·æ ¼åŠŸèƒ½æµ‹è¯• - v3.2.0</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .title { text-align: center; color: #333; margin-bottom: 30px; }
        .test-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; }
        .btn { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin: 10px 0; }
        .btn:hover { background: #0056b3; }
        .result-card { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 5px solid #007bff; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ›ï¸ äº§å“ä»·æ ¼åŠŸèƒ½æµ‹è¯• - v3.2.0</h1>
        
        <div class="test-section">
            <h3>ğŸ¯ åŠŸèƒ½è¯´æ˜</h3>
            <p><strong>æ–°åŠŸèƒ½ï¼š</strong>ç°åœ¨å¯ä»¥è¾“å…¥äº§å“ä»·æ ¼ï¼Œç³»ç»Ÿå°†è®¡ç®—ï¼š<br>
            <strong>æœ€ç»ˆæ€»ä»· = äº§å“ä»·æ ¼ + è¿è´¹ + æœåŠ¡è´¹ï¼ˆå¯é€‰ï¼‰</strong></p>
        </div>

        <div class="input-group">
            <label>
                <input type="checkbox" id="includeProductPrice" checked style="width: auto; margin-right: 10px;">
                åŒ…å«äº§å“ä»·æ ¼è®¡ç®—
            </label>
        </div>

        <div class="input-group" id="productPriceInputs">
            <label for="productPrice">äº§å“ä»·æ ¼ (RMB):</label>
            <input type="number" id="productPrice" step="0.01" min="0" placeholder="è¯·è¾“å…¥äº§å“ä»·æ ¼" value="99.99">
        </div>

        <div class="input-group">
            <label for="company">ç‰©æµå…¬å¸:</label>
            <select id="company"><option value="">é€‰æ‹©ç‰©æµå…¬å¸</option></select>
        </div>

        <div class="input-group">
            <label for="service">æœåŠ¡ç±»å‹:</label>
            <select id="service"><option value="">è¯·é€‰æ‹©æœåŠ¡ç±»å‹</option></select>
        </div>

        <div class="input-group">
            <label for="country">ç›®çš„åœ°å›½å®¶:</label>
            <select id="country"><option value="">è¯·å…ˆé€‰æ‹©æœåŠ¡ç±»å‹</option></select>
        </div>

        <div class="input-group">
            <label for="weight">åŒ…è£¹é‡é‡ (kg):</label>
            <input type="number" id="weight" step="0.001" min="0.001" placeholder="è¯·è¾“å…¥é‡é‡" value="1">
        </div>

        <div class="input-group">
            <label>
                <input type="checkbox" id="includeServiceFee" checked style="width: auto; margin-right: 10px;">
                åŒ…å« $1.2 USD æœåŠ¡è´¹
            </label>
        </div>

        <div class="input-group">
            <label for="exchangeRate">ç¾å…ƒæ±‡ç‡:</label>
            <input type="number" id="exchangeRate" step="0.01" value="7.00">
        </div>

        <button class="btn" onclick="testCalculation()">ğŸ§ª æµ‹è¯•è®¡ç®—</button>
        
        <div id="results"></div>
    </div>

    <script src="scripts/complete-database.js"></script>
    <script>
        let db = null;

        document.addEventListener('DOMContentLoaded', function() {
            db = window.completeLogisticsDB || window.logisticsDB;
            initializeSelectors();
            bindEvents();
        });

        function initializeSelectors() {
            const companies = db.getCompanies();
            const companySelect = document.getElementById('company');
            companies.forEach(company => {
                const option = document.createElement('option');
                option.value = company;
                option.textContent = company;
                companySelect.appendChild(option);
            });
            companySelect.value = 'äº‘é€”ç‰©æµ';
            onCompanyChange();
        }

        function bindEvents() {
            document.getElementById('company').addEventListener('change', onCompanyChange);
            document.getElementById('service').addEventListener('change', onServiceChange);
            document.getElementById('includeProductPrice').addEventListener('change', toggleProductPrice);
        }

        function toggleProductPrice() {
            const includeProductPrice = document.getElementById('includeProductPrice').checked;
            const productPriceInputs = document.getElementById('productPriceInputs');
            productPriceInputs.style.display = includeProductPrice ? 'block' : 'none';
        }

        function onCompanyChange() {
            const company = document.getElementById('company').value;
            const serviceSelect = document.getElementById('service');
            serviceSelect.innerHTML = '<option value="">è¯·é€‰æ‹©æœåŠ¡ç±»å‹</option>';
            
            if (company) {
                const services = db.getServices(company);
                services.forEach(service => {
                    const option = document.createElement('option');
                    option.value = service;
                    option.textContent = service;
                    serviceSelect.appendChild(option);
                });
                if (services.length > 0) {
                    serviceSelect.value = services[0];
                    onServiceChange();
                }
            }
        }

        function onServiceChange() {
            const company = document.getElementById('company').value;
            const service = document.getElementById('service').value;
            const countrySelect = document.getElementById('country');
            countrySelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç›®çš„åœ°å›½å®¶</option>';
            
            if (company && service) {
                const countries = db.getCountries(company, service);
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    countrySelect.appendChild(option);
                });
                if (countries.includes('ç¾å›½')) {
                    countrySelect.value = 'ç¾å›½';
                }
            }
        }

        function testCalculation() {
            const company = document.getElementById('company').value;
            const service = document.getElementById('service').value;
            const country = document.getElementById('country').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const includeServiceFee = document.getElementById('includeServiceFee').checked;
            const includeProductPrice = document.getElementById('includeProductPrice').checked;
            const productPrice = includeProductPrice ? (parseFloat(document.getElementById('productPrice').value) || 0) : 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 7.0;

            if (!company || !service || !country || !weight) {
                showError('è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            db.setExchangeRate(exchangeRate);
            const result = db.calculateShipping(company, service, country, weight, null, null, includeServiceFee);
            
            if (result) {
                if (includeProductPrice && productPrice > 0) {
                    result.productPrice = productPrice;
                    result.grandTotal = productPrice + result.totalPrice;
                    result.grandTotalUSD = productPrice / exchangeRate + result.totalPriceUSD;
                    result.includesProductPrice = true;
                } else {
                    result.grandTotal = result.totalPrice;
                    result.grandTotalUSD = result.totalPriceUSD;
                    result.includesProductPrice = false;
                }
                
                displayResult(result);
            } else {
                showError('è®¡ç®—å¤±è´¥');
            }
        }

        function displayResult(result) {
            document.getElementById('results').innerHTML = `
                <div class="result-card">
                    <h3>ğŸ§ª æµ‹è¯•ç»“æœ</h3>
                    <div><strong>æ¸ é“:</strong> ${result.company} - ${result.service}</div>
                    <div><strong>ç›®çš„åœ°:</strong> ${result.country}</div>
                    <div><strong>é‡é‡:</strong> ${result.weight}kg</div>
                    <hr>
                    <h4>ğŸ’° è´¹ç”¨æ˜ç»†:</h4>
                    ${result.includesProductPrice ? `<div><strong>äº§å“ä»·æ ¼:</strong> Â¥${result.productPrice.toFixed(2)} ğŸ›ï¸</div>` : ''}
                    <div><strong>è¿è´¹:</strong> Â¥${(result.weightFee || 0).toFixed(2)}</div>
                    <div><strong>æ“ä½œè´¹:</strong> Â¥${(result.handlingFee || 0).toFixed(2)}</div>
                    ${result.includesServiceFee ? 
                        `<div><strong>æœåŠ¡è´¹:</strong> Â¥${result.serviceFeeRMB.toFixed(2)} ğŸ’¼</div>` : 
                        '<div style="color: #666;">æœåŠ¡è´¹: æœªåŒ…å«</div>'
                    }
                    <hr>
                    <div><strong>ç‰©æµè´¹ç”¨:</strong> Â¥${result.totalPrice.toFixed(2)} ($${result.totalPriceUSD.toFixed(2)})</div>
                    ${result.includesProductPrice ? 
                        `<div style="font-size: 18px; font-weight: bold; color: #007bff;">
                            <strong>ğŸ¯ æœ€ç»ˆæ€»ä»·:</strong> Â¥${result.grandTotal.toFixed(2)} ($${result.grandTotalUSD.toFixed(2)})
                        </div>` : ''
                    }
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('results').innerHTML = `<div class="error">âŒ ${message}</div>`;
        }
    </script>
</body>
</html> 