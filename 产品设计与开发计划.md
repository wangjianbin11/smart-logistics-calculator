# 智能报价机器人 - 产品设计与开发计划

## 1. 项目概述

**目标**: 开发一款企业级的智能报价谷歌浏览器插件。该插件需具备处理复杂、多维度数据的能力，能根据产品属性、重量、全球目的地、多样化物流渠道等因素，快速、准确地生成最终报价，并提供一个完善的数据管理后台。

**核心挑战**:
- **数据量庞大**: 需覆盖全球所有国家、多家物流公司及其对应的复杂报价规则。
- **判断逻辑复杂**: 产品属性（如是否带电、是否为液体）会直接影响可选的物流渠道和价格。
- **数据实时性**: 汇率、燃油附加费等数据需要能被方便地更新。

---

## 2. 功能点设计 (Features)

### 2.1. 核心报价引擎 (已完成原型)
- **输入模块**:
  - `产品名称` (用于关联产品属性)
  - `重量` (公斤)
  - `产品成本` (人民币)
- **输出模块**:
  - `产品总成本`
  - `物流费用`
  - `关税`
  - `附加费用` (如操作费、燃油附加费)
  - `利润`
  - `最终人民币报价`
  - `目标货币报价` (根据汇率自动转换)

### 2.2. 动态数据库系统 (需要集成您的数据)
这是本项目的核心，旨在将您庞大的数据结构化、系统化。

**A. 物流渠道数据库**:
- **结构**: `物流公司` -> `具体渠道` -> `目的地国家` -> `价格阶梯`
- **示例**:
  - DHL (物流公司)
    - `DHL-标准服务` (渠道)
      - `美国` (目的地):
        - `0-0.5kg`: ￥150
        - `0.5-1kg`: ￥200
        - `1kg以上`: ￥180/kg
      - `英国`: ...
    - `DHL-带电产品服务`: ...
  - FedEx (物流公司): ...

**B. 全球目的地数据库**:
- **字段**:
  - `国家名称` (中/英文)
  - `国家二字码` (ISO Code, 如 US, GB, JP)
  - `基础关税率` (%)
  - `货币代码` (如 USD, EUR)
  - `当前汇率` (1 CNY to X Target Currency)

**C. 产品属性数据库**:
- **目的**: 这是解决复杂判断逻辑的关键。
- **结构**: 每个产品可以关联一个或多个属性。
- **字段**:
  - `属性ID` (如: `battery`, `liquid`, `oversize`, `magnetic`)
  - `属性名称` (如: 带电池, 液体, 超大件, 带磁性)
  - `附加操作费` (￥)
  - `禁运渠道`: [渠道ID列表] (例如液体产品不能走 `HK-Post`)
  - `推荐渠道`: [渠道ID列表]
  - `附加关税类别`: (例如电子产品类别的附加关税)

**D. 利润模型数据库**:
- **结构**: 可按 `渠道` 或 `目的地国家` 或 `总成本区间` 设置不同利润。
- **字段**:
  - `规则类型` (渠道/国家/成本)
  - `规则值` (例如: `DHL-标准服务` 或 `美国` 或 `0-1000元`)
  - `利润率` (%)
  - `固定利润` (￥)
  - `最低利润` (￥)

### 2.3. 后台管理系统 (已完成原型)
- **UI**: 基于 `options.html` 页面进行扩展。
- **功能**:
  - **增删改查**: 对上述所有数据库（物流、目的地、产品属性、利润模型）进行全面的可视化管理。
  - **批量导入/导出**: 支持通过 CSV 或 Excel 文件批量更新数据，解决数据量大的问题。
  - **数据筛选与搜索**: 快速查找特定国家或渠道的费率。

---

## 3. 开发计划 (Phases)

### **第一阶段: 核心框架与原型 (状态: ✅ 已完成)**
- **内容**:
  - `manifest.json`, `popup.html`, `options.html` 等基础文件创建。
  - 基础的 `database.js`, `calculator.js` 逻辑。
  - 带有少量示例数据的用户界面和设置界面。
- **目的**: 验证了插件的基本可行性，并为您提供了一个可交互的原型。

### **第二阶段: 大规模数据集成与逻辑深化 (当前阶段)**
- **任务**:
  1. **数据结构确认**: 您审核并确认我在 `2.2` 章节设计的数据库结构是否满足您的业务需求。
  2. **数据提供**: 您提供给我详细、真实的业务数据（物流价格表、国家列表、产品属性分类等），可以是Excel、CSV或其他格式。
  3. **数据集成**: 我将编写脚本，将您提供的数据清洗、处理，并导入到插件的 `Chrome Storage` 数据库中。
  4. **判断逻辑编码**: 我会根据产品属性、目的地等复杂判断条件，完善 `calculator.js` 中的计算逻辑。
- **预计产出**: 一个填充了您真实业务数据、报价逻辑准确的插件版本。

### **第三阶段: 后台管理与批量操作**
- **任务**:
  1. **后台功能增强**: 完善 `options.html` 页面，为所有数据表提供完整的增删改查界面。
  2. **实现批量导入/导出**: 开发支持CSV/Excel数据导入导出的功能，方便您未来自行维护数据。
- **预计产出**: 一个您可以通过界面方便地自行维护和更新所有数据的全功能插件。

### **第四阶段: 优化与测试**
- **任务**:
  1. **性能优化**: 针对大数据量进行查询优化，确保插件运行流畅。
  2. **用户体验 (UX) 优化**: 根据您的使用反馈，调整界面和操作流程。
  3. **全面测试**: 进行多场景测试，确保各种产品和国家的组合报价都准确无误。
- **预计产出**: 一个稳定、可靠、高效的最终版本。

---

## 4. 后续步骤 (Next Steps)

1.  **请您审核本文档**: 特别是 **第二部分 (功能点设计)** 中的数据结构，看是否符合您的业务逻辑。
2.  **提供数据**: 如果您确认计划，请准备好 **第二阶段** 所需的详细数据。您可以先提供一部分数据（例如一两家物流公司的完整价格表），我来将其集成作为示例。
3.  **开始执行**: 我将根据您的确认，立即开始 **第二阶段** 的开发工作。

我完全有能力根据您的复杂需求，完成这个功能强大的报价工具。这个设计文档就是我们接下来合作的蓝图。 