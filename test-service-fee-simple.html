<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡è´¹åŠŸèƒ½ç®€åŒ–æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .service-fee-box {
            border: 3px solid #ffc107;
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            accent-color: #28a745;
        }
        .checkbox-container label {
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        .status {
            font-weight: bold;
            color: #007bff;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æœåŠ¡è´¹åŠŸèƒ½ç®€åŒ–æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>1. æœåŠ¡è´¹é€‰æ‹©æµ‹è¯•</h3>
        <div class="service-fee-box">
            <div class="checkbox-container">
                <input type="checkbox" id="serviceFeeTest" checked>
                <label for="serviceFeeTest">åŒ…å« $1.2 USD æœåŠ¡è´¹ ğŸ’¼</label>
            </div>
            <div style="font-size: 14px; color: #856404;">
                ğŸ’¡ æœåŠ¡è´¹åŒ…å«è®¢å•å¤„ç†ã€å®¢æœæ”¯æŒç­‰å¢å€¼æœåŠ¡
            </div>
        </div>
        <div class="status" id="checkboxStatus">çŠ¶æ€: å·²é€‰ä¸­ âœ…</div>
        
        <button onclick="testCheckbox()">æ£€æŸ¥é€‰æ‹©çŠ¶æ€</button>
        <button onclick="toggleCheckbox()">åˆ‡æ¢é€‰æ‹©çŠ¶æ€</button>
    </div>

    <div class="test-section">
        <h3>2. æœåŠ¡è´¹è®¡ç®—æµ‹è¯•</h3>
        <div>
            <label>åŸºç¡€è¿è´¹ (RMB): </label>
            <input type="number" id="basePrice" value="50" style="padding: 5px; margin: 10px;">
        </div>
        <div>
            <label>ç¾å…ƒæ±‡ç‡: </label>
            <input type="number" id="exchangeRate" value="7.00" step="0.01" style="padding: 5px; margin: 10px;">
        </div>
        
        <button onclick="calculateWithServiceFee()">è®¡ç®—å«æœåŠ¡è´¹ä»·æ ¼</button>
        <button onclick="calculateWithoutServiceFee()">è®¡ç®—ä¸å«æœåŠ¡è´¹ä»·æ ¼</button>
        
        <div id="calculationResult"></div>
    </div>

    <div class="test-section">
        <h3>3. æ•°æ®åº“åŠŸèƒ½æµ‹è¯•</h3>
        <div>
            <button onclick="testDatabaseServiceFee()">æµ‹è¯•æ•°æ®åº“æœåŠ¡è´¹è®¡ç®—</button>
            <div id="databaseTestResult"></div>
        </div>
    </div>

    <script src="scripts/complete-database.js"></script>
    <script>
        // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€æ˜¾ç¤º
        function updateCheckboxStatus() {
            const checkbox = document.getElementById('serviceFeeTest');
            const status = document.getElementById('checkboxStatus');
            const isChecked = checkbox.checked;
            
            status.innerHTML = `çŠ¶æ€: ${isChecked ? 'å·²é€‰ä¸­ âœ…' : 'æœªé€‰ä¸­ âŒ'}`;
            status.style.color = isChecked ? '#28a745' : '#dc3545';
        }

        // æµ‹è¯•å¤é€‰æ¡†
        function testCheckbox() {
            updateCheckboxStatus();
            console.log('å¤é€‰æ¡†çŠ¶æ€:', document.getElementById('serviceFeeTest').checked);
        }

        // åˆ‡æ¢å¤é€‰æ¡†
        function toggleCheckbox() {
            const checkbox = document.getElementById('serviceFeeTest');
            checkbox.checked = !checkbox.checked;
            updateCheckboxStatus();
        }

        // è®¡ç®—å«æœåŠ¡è´¹ä»·æ ¼
        function calculateWithServiceFee() {
            const basePrice = parseFloat(document.getElementById('basePrice').value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 7.0;
            const serviceFeeUSD = 1.2;
            const serviceFeeRMB = serviceFeeUSD * exchangeRate;
            const totalPrice = basePrice + serviceFeeRMB;
            const totalPriceUSD = totalPrice / exchangeRate;

            document.getElementById('calculationResult').innerHTML = `
                <div class="result">
                    <h4>å«æœåŠ¡è´¹è®¡ç®—ç»“æœ:</h4>
                    <div>åŸºç¡€è¿è´¹: Â¥${basePrice.toFixed(2)}</div>
                    <div>æœåŠ¡è´¹: Â¥${serviceFeeRMB.toFixed(2)} ($${serviceFeeUSD})</div>
                    <div>æ€»ä»·: Â¥${totalPrice.toFixed(2)} (â‰ˆ $${totalPriceUSD.toFixed(2)})</div>
                </div>
            `;
        }

        // è®¡ç®—ä¸å«æœåŠ¡è´¹ä»·æ ¼
        function calculateWithoutServiceFee() {
            const basePrice = parseFloat(document.getElementById('basePrice').value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 7.0;
            const totalPriceUSD = basePrice / exchangeRate;

            document.getElementById('calculationResult').innerHTML = `
                <div class="result">
                    <h4>ä¸å«æœåŠ¡è´¹è®¡ç®—ç»“æœ:</h4>
                    <div>åŸºç¡€è¿è´¹: Â¥${basePrice.toFixed(2)}</div>
                    <div>æœåŠ¡è´¹: Â¥0.00 (æœªåŒ…å«)</div>
                    <div>æ€»ä»·: Â¥${basePrice.toFixed(2)} (â‰ˆ $${totalPriceUSD.toFixed(2)})</div>
                </div>
            `;
        }

        // æµ‹è¯•æ•°æ®åº“æœåŠ¡è´¹åŠŸèƒ½
        function testDatabaseServiceFee() {
            try {
                const db = window.completeLogisticsDB || window.logisticsDB;
                if (!db) {
                    throw new Error('æ•°æ®åº“æœªåŠ è½½');
                }

                // è®¾ç½®æ±‡ç‡
                const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 7.0;
                db.setExchangeRate(exchangeRate);

                // æµ‹è¯•å‚æ•°
                const company = 'äº‘é€”ç‰©æµ';
                const service = 'ä¸“çº¿æŒ‚å·ç‰¹æƒ æ™®è´§';
                const country = 'ç¾å›½';
                const weight = 1;

                // æµ‹è¯•ä¸å«æœåŠ¡è´¹
                const resultWithoutFee = db.calculateShipping(company, service, country, weight, null, null, false);
                console.log('ä¸å«æœåŠ¡è´¹ç»“æœ:', resultWithoutFee);

                // æµ‹è¯•å«æœåŠ¡è´¹
                const resultWithFee = db.calculateShipping(company, service, country, weight, null, null, true);
                console.log('å«æœåŠ¡è´¹ç»“æœ:', resultWithFee);

                if (resultWithoutFee && resultWithFee) {
                    const feeDifference = resultWithFee.totalPrice - resultWithoutFee.totalPrice;
                    const expectedFee = 1.2 * exchangeRate;
                    const isCorrect = Math.abs(feeDifference - expectedFee) < 0.01;

                    document.getElementById('databaseTestResult').innerHTML = `
                        <div class="result">
                            <h4>æ•°æ®åº“æµ‹è¯•ç»“æœ:</h4>
                            <div>æµ‹è¯•æ¸ é“: ${company} - ${service}</div>
                            <div>ç›®çš„åœ°: ${country}</div>
                            <div>é‡é‡: ${weight}kg</div>
                            <div>æ±‡ç‡: 1 USD = ${exchangeRate} RMB</div>
                            <hr>
                            <div>ä¸å«æœåŠ¡è´¹: Â¥${resultWithoutFee.totalPrice.toFixed(2)}</div>
                            <div>å«æœåŠ¡è´¹: Â¥${resultWithFee.totalPrice.toFixed(2)}</div>
                            <div>æœåŠ¡è´¹å·®é¢: Â¥${feeDifference.toFixed(2)}</div>
                            <div>æœŸæœ›å·®é¢: Â¥${expectedFee.toFixed(2)}</div>
                            <div style="color: ${isCorrect ? 'green' : 'red'}; font-weight: bold;">
                                è®¡ç®—éªŒè¯: ${isCorrect ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error('è®¡ç®—å¤±è´¥');
                }

            } catch (error) {
                document.getElementById('databaseTestResult').innerHTML = `
                    <div style="color: red; padding: 10px; background: #f8d7da; border-radius: 5px;">
                        âŒ æµ‹è¯•å¤±è´¥: ${error.message}
                    </div>
                `;
                console.error('æ•°æ®åº“æµ‹è¯•é”™è¯¯:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šå¤é€‰æ¡†äº‹ä»¶
            document.getElementById('serviceFeeTest').addEventListener('change', updateCheckboxStatus);
            
            // åˆå§‹åŒ–çŠ¶æ€
            updateCheckboxStatus();
            
            console.log('ç®€åŒ–æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html> 